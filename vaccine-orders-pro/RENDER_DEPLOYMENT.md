# Render Deployment Guide

This guide walks you through deploying the Vaccine Orders application to Render using GitHub.

## Prerequisites

- GitHub account
- Render account (free at https://render.com)
- Git installed locally

## Step 1: Push to GitHub

### Create a new GitHub repository

1. Go to https://github.com/new and create a new repository
2. Name it `vaccine-orders-pro` (or your preferred name)
3. Initialize it as a public repository
4. Do NOT initialize with README (we'll push our existing code)

### Push your code to GitHub

```bash
cd c:\Users\Neko\Desktop\pharmecomd\pharmecom\vaccine-orders-pro

# Initialize git if not already done
git init

# Add GitHub as remote (replace YOUR_USERNAME and YOUR_REPO)
git remote add origin https://github.com/YOUR_USERNAME/vaccine-orders-pro.git

# Add all files
git add .

# Initial commit
git commit -m "Initial commit: Vaccine Orders Pro application"

# Push to GitHub
git branch -M main
git push -u origin main
```

## Step 2: Deploy to Render

### Backend Deployment

1. **Go to Render Dashboard**: https://dashboard.render.com
2. **Click "New +"** → **"Web Service"**
3. **Connect GitHub Repository**:
   - Select "GitHub" as the repository source
   - Authorize Render with your GitHub account if prompted
   - Select your `vaccine-orders-pro` repository
   - Leave branch as `main`

4. **Configure Settings**:
   - **Name**: `vaccine-orders-backend`
   - **Environment**: `Python 3.8`
   - **Build Command**: `cd backend && pip install -r requirements.txt && python manage.py migrate && python manage.py collectstatic --noinput`
   - **Start Command**: `cd backend && gunicorn core.wsgi:application`
   - **Instance Type**: Free (or pay as you go)

5. **Add Environment Variables**:
   Click "Advanced" and add these:
   ```
   DEBUG=False
   SECRET_KEY=(Render will generate this)
   ALLOWED_HOSTS=.onrender.com,localhost
   DATABASE_URL=(Render PostgreSQL URL - see PostgreSQL setup below)
   CORS_ALLOWED_ORIGINS=https://vaccine-orders-frontend.onrender.com
   ```

6. **Click "Create Web Service"**

### Frontend Deployment

1. **Click "New +"** → **"Web Service"** again
2. **Connect same GitHub repository**
3. **Configure Settings**:
   - **Name**: `vaccine-orders-frontend`
   - **Environment**: `Node`
   - **Node Version**: `18`
   - **Build Command**: `npm install && npm run build`
   - **Start Command**: `npm run preview`
   - **Instance Type**: Free

4. **Add Environment Variables**:
   ```
   VITE_API_URL=https://vaccine-orders-backend.onrender.com/api
   ```

5. **Click "Create Web Service"**

### PostgreSQL Database Setup

1. **Click "New +"** → **"PostgreSQL"**
2. **Configure**:
   - **Name**: `vaccine-orders-db`
   - **Region**: Choose closest to you
   - **PostgreSQL Version**: 15
   - **Instance Type**: Free

3. **Once created**, copy the `External Database URL` from the dashboard
4. **Add to Backend service**:
   - Go to Backend service settings
   - Add environment variable `DATABASE_URL` with the copied URL
   - Skip the build step and redeploy by pushing a commit:
     ```bash
     git commit --allow-empty -m "Trigger redeployment with database"
     git push origin main
     ```

## Step 3: Verify Deployment

Once both services are deployed (green status):

1. **Frontend**: Visit `https://vaccine-orders-frontend.onrender.com`
2. **API**: Visit `https://vaccine-orders-backend.onrender.com/api/products/`

You should see your application and API responses!

## Step 4: Database Migrations (First Time)

After final deployment with PostgreSQL:

1. Go to your Backend service in Render
2. Click the **"Shell"** tab
3. Run:
   ```bash
   python manage.py migrate
   python manage.py createsuperuser
   ```

## Troubleshooting

### 1. **Build Fails - "python-decouple not found"**
   - Ensure `python-decouple` is in `backend/requirements.txt`
   - Push a new commit: `git commit --allow-empty -m "Trigger rebuild"; git push origin main`

### 2. **Frontend API Errors**
   - Check that `VITE_API_URL` in frontend env variables matches backend URL
   - Verify backend `CORS_ALLOWED_ORIGINS` includes frontend URL

### 3. **500 Error on API**
   - Check Backend logs in Render dashboard
   - Ensure all migrations ran successfully
   - Verify `DATABASE_URL` environment variable is set

### 4. **Database Connection Issues**
   - Verify PostgreSQL service is deployed and running
   - Check `DATABASE_URL` format is correct
   - Ensure Backend has access to database

## Updating Your App

To deploy new changes:

```bash
# Make your changes
git add .
git commit -m "Description of changes"
git push origin main
```

Render will automatically redeploy both services!

## Environment Variables Reference

### Backend
- `DEBUG`: Set to `False` in production
- `SECRET_KEY`: Django secret key (auto-generated by Render)
- `ALLOWED_HOSTS`: Comma-separated list of allowed domains
- `DATABASE_URL`: PostgreSQL connection string
- `CORS_ALLOWED_ORIGINS`: Comma-separated list of allowed frontend URLs

### Frontend
- `VITE_API_URL`: Base URL for API calls (should be backend service URL + `/api`)

## Cost

- **Free tier includes**:
  - 0.5 CPU, 0.5 GB RAM per service
  - 100GB bandwidth/month
  - PostgreSQL databases
  - Up to 750 open hours/month per service

For production with higher traffic, consider upgrading to paid instances.

## Support

- Render Docs: https://render.com/docs
- Django Deployment: https://docs.djangoproject.com/en/4.2/howto/deployment/
- React/Vite Build: https://vitejs.dev/guide/build.html
